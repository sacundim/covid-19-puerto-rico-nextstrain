
## This YAML file is sparsely commented, with a focus on the parts relevant to multiple inputs
## See my_profiles/example/builds.yaml for more general comments
## See docs/multiple_inputs.md for a walkthrough of this config.

# Note: unaligned sequences are provided as "aligned" sequences to avoid an initial full-DB alignment
# as we re-align everything after subsampling.
inputs:
  - name: "open"
    metadata: "https://data.nextstrain.org/files/ncov/open/metadata.tsv.gz"
    aligned: "https://data.nextstrain.org/files/ncov/open/sequences.fasta.xz"
    skip_sanitize_metadata: true

builds:
  puerto-rico:
    division: Puerto Rico
    country: USA
    region: North America
    subsampling_scheme: divisional

subsampling:
  divisional:
    division_late:
      group_by: "year month"
      max_sequences: 1500
      sampling_scheme: "--probabilistic-sampling"
      query: --query "(country == '{country}' & division == '{division}')"
    country_late:
      group_by: "division year month"
      max_sequences: 800
      sampling_scheme: "--probabilistic-sampling"
      query: --query "(country == '{country}' & division != '{division}')"
    global_late:
      group_by: "region year month"
      max_sequences: 800
      sampling_scheme: "--probabilistic-sampling"
      query: --query "country != '{country}'"

    division_early:
      group_by: "year month"
      max_sequences: 1500
      sampling_scheme: "--probabilistic-sampling"
      query: --query "(country == '{country}' & division == '{division}')"
    country_early:
      group_by: "division year month"
      max_sequences: 600
      sampling_scheme: "--probabilistic-sampling"
      query: --query "(country == '{country}' & division != '{division}')"
    global_early:
      group_by: "region year month"
      max_sequences: 600
      sampling_scheme: "--probabilistic-sampling"
      query: --query "country != '{country}'"


# GenBank data includes "Wuhan-Hu-1/2019" which we use as the root for this build
# as Wuhan/Hu-1/2019 is not in the data.
refine:
  root: "Wuhan-Hu-1/2019"

files:
  auspice_config: "puerto-rico_profiles/puerto-rico_open/puerto-rico_auspice_config.json"
  description: "puerto-rico_profiles/puerto-rico_open/puerto-rico_description.md"
