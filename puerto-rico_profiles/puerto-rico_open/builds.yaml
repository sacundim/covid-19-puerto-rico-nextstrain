
custom_rules:
  - nextstrain_profiles/nextstrain-gisaid/subsampling_ranges.smk

inputs:
  - name: "open"
    metadata: "s3://nextstrain-data/files/ncov/open/metadata.tsv.gz"
    aligned: "s3://nextstrain-data/files/ncov/open/sequences.fasta.xz"
    skip_sanitize_metadata: true

builds:
  puerto-rico:
    division: Puerto Rico
    country: USA
    region: North America
    subsampling_scheme: divisional

subsampling:
  divisional:
    division_late:
      group_by: "year month"
      max_sequences: 1500
      sampling_scheme: "--probabilistic-sampling"
      query: --query "(country == '{country}' & division == '{division}')"
    country_late:
      group_by: "division year month"
      max_sequences: 800
      sampling_scheme: "--probabilistic-sampling"
      query: --query "(country == '{country}' & division != '{division}')"
    global_late:
      group_by: "region year month"
      max_sequences: 800
      sampling_scheme: "--probabilistic-sampling"
      query: --query "country != '{country}'"

    division_early:
      group_by: "year month"
      max_sequences: 1500
      sampling_scheme: "--probabilistic-sampling"
      query: --query "(country == '{country}' & division == '{division}')"
    country_early:
      group_by: "division year month"
      max_sequences: 600
      sampling_scheme: "--probabilistic-sampling"
      query: --query "(country == '{country}' & division != '{division}')"
    global_early:
      group_by: "region year month"
      max_sequences: 600
      sampling_scheme: "--probabilistic-sampling"
      query: --query "country != '{country}'"


# GenBank data includes "Wuhan-Hu-1/2019" which we use as the root for this build
# as Wuhan/Hu-1/2019 is not in the data.
refine:
  root: "Wuhan-Hu-1/2019"

files:
  auspice_config: "puerto-rico_profiles/puerto-rico_open/puerto-rico_auspice_config.json"
  description: "puerto-rico_profiles/puerto-rico_open/puerto-rico_description.md"
